<svg xmlns="http://www.w3.org/2000/svg" width="600" height="720" viewBox="0 0 600 720">
    <style>
        .label { font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; font-size: 14px; fill: #333; }
        .title { font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #111; }
        .box { fill: #f9f9f9; stroke: #333; stroke-width: 1.5; }
        .group-box { fill: #f0f4f8; stroke: #99b4d1; stroke-width: 1; rx: 5; ry: 5; }
        .arrow { fill: #333; }
    </style>

    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" class="arrow" />
        </marker>
    </defs>

    <!-- Subgraph: Input -->
    <rect x="20" y="20" width="220" height="120" class="group-box"/>
    <text x="130" y="40" text-anchor="middle" class="title">Input</text>
    <rect x="50" y="60" width="160" height="40" rx="5" ry="5" class="box"/>
    <text x="130" y="85" text-anchor="middle" class="label">Plan.yaml</text>
    
    <rect x="280" y="20" width="220" height="120" class="group-box"/>
    <text x="390" y="40" text-anchor="middle" class="title">Tool Library</text>
    <rect x="310" y="60" width="160" height="40" rx="5" ry="5" class="box"/>
    <text x="390" y="85" text-anchor="middle" class="label">Tool Library</text>

    <!-- Subgraph: Execution Engine -->
    <rect x="20" y="160" width="560" height="380" class="group-box"/>
    <text x="300" y="180" text-anchor="middle" class="title">Execution Engine</text>
    
    <rect x="220" y="200" width="160" height="40" rx="5" ry="5" class="box"/>
    <text x="300" y="225" text-anchor="middle" class="label">Load Plan</text>

    <rect x="220" y="280" width="160" height="50" rx="5" ry="5" class="box"/>
    <text x="300" y="300" text-anchor="middle" class="label">For each step in Plan</text>

    <rect x="220" y="370" width="160" height="50" rx="5" ry="5" class="box"/>
    <text x="300" y="395" text-anchor="middle" class="label">Execute Tool(...)</text>

    <path d="M300,460 L260,500 L300,540 L340,500 Z" class="box"/>
    <text x="300" y="505" text-anchor="middle" class="label">Check Result</text>

    <!-- Subgraph: Output -->
    <rect x="20" y="560" width="260" height="120" class="group-box"/>
    <text x="150" y="580" text-anchor="middle" class="title">Output</text>
    <rect x="50" y="600" width="200" height="40" rx="5" ry="5" class="box"/>
    <text x="150" y="625" text-anchor="middle" class="label">Success: Final State</text>

    <rect x="320" y="560" width="260" height="120" class="group-box"/>
    <text x="450" y="580" text-anchor="middle" class="title">Output</text>
    <rect x="350" y="600" width="200" height="40" rx="5" ry="5" class="box"/>
    <text x="450" y="625" text-anchor="middle" class="label">Failure: Error Report</text>

    <!-- Arrows -->
    <line x1="130" y1="100" x2="290" y2="200" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <line x1="390" y1="100" x2="310" y2="370" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <line x1="300" y1="240" x2="300" y2="280" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <line x1="300" y1="330" x2="300" y2="370" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <line x1="300" y1="420" x2="300" y2="460" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <line x1="300" y1="540" x2="150" y2="600" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="220" y="560" class="label">All steps complete</text>
    <line x1="340" y1="500" x2="450" y2="600" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="400" y="540" class="label">Error</text>
    <path d="M260,500 C 180 450, 180 350, 260 300" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>
    <text x="200" y="370" class="label">OK</text>

</svg>